<html>

<head>

<style>
.tdGame
{
	width: 20px;
	height:20px;
}

.site
{
	width: 330px;
	padding:0px;
	border: 0px solid black;
	margin-left : auto;
	margin-right : auto;
	text-align:center;
}

.inSite
{
	padding:20px;
	border: 1px solid black;
}

#board table, tr, td
{
	padding:0px;
	margin:0px;
	border:1px solid white;
	border-collapse: collapse;
}
</style>

<script>

var nbCells = 2;
var width = 300;
var difficulty = 0;
var score = 0;
var anim = 0;
var colorTarget =  0;
var colorCurrent = 0;
var colorBase =  0;
var nbCasesToFind = 0;

function animate(){

	var step = Math.floor((colorCurrent - colorBase) / 10);
	step = Math.max(1,step);

	var cells = document.getElementsByName("cellWin");
	//console.log(colorTarget+'/'+colorBase);
	if(colorCurrent - colorBase > step)
		colorCurrent -= step;
	else {
		colorCurrent = colorBase;
	}
	for(var i=0;i<cells.length;i++){
		cells[i].style.backgroundColor = toHexColor(colorCurrent,colorCurrent,colorCurrent);
	}
}

function go()
{
	makeGame(width,nbCells,1-difficulty);
	anim = setInterval(animate,10);
}

function win(){

	nbCasesToFind--;
	if(nbCasesToFind <= 0)
	{
		score ++;
		document.getElementById("res").innerHTML = "Pas mal... "+score+'pt';
		//if(Math.random() < 0.7) {
			if(difficulty >= 0.95)
				difficulty = Math.min(0.99,difficulty + 0.01);
			else
				difficulty = Math.min(0.95,difficulty + 0.05);
		//}else{
		//	nbCells = Math.min(6, nbCells+1);
		//}
		makeGame(width,nbCells,1-difficulty);
	}

	console.log(difficulty);

}

function fail(){

	score = Math.max(0,score -1);
	document.getElementById("res").innerHTML = "Oups ! " +score+'pt';

	//if(Math.random() < 0.7) {
		if(difficulty > 0.95)
			difficulty = difficulty - 0.01;
		else
			difficulty = Math.max(0,difficulty - 0.05);
	//}else{
	//	nbCells = Math.max(2,nbCells-1);
	//}

	makeGame(width,nbCells,1-difficulty);

	console.log(difficulty);
}

function toHex(d) {
    return  ("0"+(Number(d).toString(16))).slice(-2).toUpperCase()
}

function toHexColor(R,V,B){
	return "#"+toHex(R)+toHex(V)+toHex(B);
}

function makeGame(width,nbCellsX,diffColor)
{
	nbCellsX = 5;

	//Calc des props
	var widthCell = width / nbCellsX;
	var colorBaseR = Math.floor(Math.random() * 128 + 64);
	var colorBaseV = Math.floor(Math.random() * 128 + 64);
	var colorBaseB = Math.floor(Math.random() * 128 + 64);

	colorBaseR = 128;
	colorBaseV = colorBaseR;
	colorBaseB = colorBaseR;


	colorBase = colorBaseR;

	var colorFindR = Math.floor(colorBaseR + 64 * diffColor);
	var colorFindV = Math.floor(colorBaseV + 64 * diffColor);
	var colorFindB = Math.floor(colorBaseB + 64 * diffColor);

	colorTarget = colorFindB;
	colorCurrent = colorTarget;

	var colorBaseHex = toHexColor(colorBaseR,colorBaseV,colorBaseB);
	var colorFindHex = toHexColor(colorFindR,colorFindV,colorFindB);

	console.log(colorBaseHex);
	console.log(colorFindHex);

	var cases = [];

	var nbCells = 4;
	nbCasesToFind = 4;
	for(var i=0;i<nbCells;i++)	{
		var ijFind = 0;
		while(cases.indexOf(ijFind) >= 0)
			ijFind = Math.floor(Math.random() * (nbCellsX * nbCellsX));
		cases.push(ijFind);
	}

	var iFind = Math.floor(Math.random() * nbCellsX);
	var jFind = Math.floor(Math.random() * nbCellsX);

	var iDecoy = Math.floor(Math.random() * nbCellsX);
	var jDecoy = Math.floor(Math.random() * nbCellsX);

	var strHtml = '';
	strHtml += '<table>';
	for(var i=0;i<nbCellsX;i++)
	{
		strHtml += '<tr>';
		for(var j=0;j<nbCellsX;j++)
		{
			var color = colorBaseHex;
			var clickFun = "fail()";
			var name = "cellFail";

			var ijFind = i + j * nbCellsX;

			if(cases.indexOf(ijFind) >= 0) {
				color = colorFindHex;
				clickFun = "win()";
				name = "cellWin";
			}


			strHtml += '<td name="'+name+'" style="background-color:'+color+'; width:'+widthCell+'px; height:'+widthCell+'px" onclick="'+clickFun+'">&nbsp;';
			strHtml += '</td>';
		}
		strHtml += '</tr>';
	}
	strHtml += '</table>';

	document.getElementById("board").innerHTML = strHtml;
}

</script>

</head>

<body onload="go()">
<div class="site">
<h2>Le jeu ou tu vois rien !</h2>
<div class="inSite">
<div id="board"></div>
<div id="res">Score</div>
</div>
<a href="tomcruise.html">doigt</a>::
<a href="test2.html">yeux</a>::
<a href="test3.html">tete</a>
</div>

</body>

</html>
